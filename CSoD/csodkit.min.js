var CsodApi=function(a){this.config=a};CsodApi.prototype.getUtcDate=function(c){var e=c.getUTCFullYear().toString();var g=(c.getUTCMonth()+1).toString();if(g.length==1){g="0"+g}var b=c.getUTCDate().toString();if(b.length==1){b="0"+b}var a=c.getUTCHours().toString();if(a.length==1){a="0"+a}var d=c.getUTCMinutes().toString();if(d.length==1){d="0"+d}var h=c.getUTCSeconds().toString();if(h.length==1){h="0"+h}var f=c.getUTCMilliseconds().toString();if(f.length<=1){f="0"+f}if(f.length==2){f="0"+f}return e+"-"+g+"-"+b+"T"+a+":"+d+":"+h+".000"
};CsodApi.prototype.getApiSignature=function(c,b,a,e,d){var f=e+"\nx-csod-api-key:"+b+"\nx-csod-date:"+new String(d)+"\n"+c;return this.getSignature(this.config.apiSecret,f)};CsodApi.prototype.getSignature=function(a,e){var c=CryptoJS.enc.Base64.parse(a);var d=CryptoJS.HmacSHA512(e,c);var b=d.toString(CryptoJS.enc.Base64);return b};CsodApi.prototype.generateSession=function(h,c){var b="/services/api/sts/Session";var f=this.config.portal+b+"?userName="+this.config.userName+"&alias="+this.config.sessionName;
var g=this.getUtcDate(new Date());var a=this.getApiSignature(b,this.config.apiKey,this.config.apiSecret,"POST",g);var e=this.config;var d={url:f,headers:{"x-csod-date":g,"x-csod-api-key":this.config.apiKey,"x-csod-signature":a},type:"POST",contentType:"text/xml",dataType:"text/xml",success:function(j){try{e.sessionToken=$("a\\:Token, Token",j.documentElement).text();e.sessionSecret=$("a\\:Secret, Secret",j.documentElement).text();e.ExpiresOn=$("a\\:ExpiresOn, ExpiresOn",j.documentElement).text()}catch(i){}if(typeof(h)=="function"){h(j)
}},error:function(i){if(typeof(c)=="function"){c(i)}}};return d};CsodApi.prototype.getCSODHeaders=function(e,d,b,f,g){var h=this.config.ExpiresOn!=null?this.config.ExpiresOn:this.getUtcDate(new Date());var c=d+"\nx-csod-date:"+new String(h)+"\nx-csod-session-token:"+this.config.sessionToken+"\n"+e;var a=this.getSignature(this.config.sessionSecret,c);var i={url:this.config.portal+e+(typeof(b)!="undefined"?b:""),headers:{"x-csod-date":h,"x-csod-session-token":this.config.sessionToken,"x-csod-signature":a},type:d,contentType:"text/xml",dataType:"text/xml",success:function(j){if(typeof(f)=="function"){f(j)
}},error:function(j){if(typeof(g)=="function"){g(j)}}};return i};CsodApi.prototype.getData=function(a,e,f,c){if(this.config.sessionSecret==null||this.config.sessionToken==null){var d={onSuccess:function(i,h){try{console.log("LOGIN CSoD API REST")}catch(g){}},onFail:function(i,h){try{console.log("ERROR CSoD API REST: "+i)}catch(g){}}};var b=this.generateSession(d.onSuccess,d.onFail);extQuery$.ajax({url:b.url,async:false,headers:b.headers,type:b.type,contentType:b.contentType,error:b.error})}return this.getServiceData(a,e,f,c)
};CsodApi.prototype.getServiceData=function(a,e,g,c){var d="GET";var a=a||"/services/api/sts/Session";if(e!=null){var f=new RegExp(" ","g");var b=e.replace(f,"%20");e=(e!=null)?"?"+b:""}return this.getCSODHeaders(a,d,e,g,c)};